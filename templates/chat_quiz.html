{% extends 'base.html' %}

{% block content %}

<div class="container py-5">

    <!-- ===== HEADER ===== -->
    <div class="text-center mb-4">
        <h2 class="fw-bold" style="
            font-size: 2.6rem;
            color:#111827;
            text-shadow: 0 4px 15px rgba(0,0,0,0.12);
        ">
            AI
            <span style="
                background: linear-gradient(135deg, #f59e0b, #fb7185);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            ">
                Tutor
            </span>
        </h2>

        <p style="
            font-size: 1.05rem;
            font-weight: 500;
            color:#374151;
            background: rgba(255,255,255,0.85);
            display: inline-block;
            padding: 8px 16px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        ">
            Ask doubts or type <b>‚ÄúQuiz me on any topic‚Äù</b> to start
        </p>
    </div>

    <!-- ===== CHAT CARD ===== -->
    <div class="glass-card d-flex flex-column mx-auto"
         style="max-width: 720px; height: 65vh;">

        <!-- CHAT BOX -->
        <div id="chat-box" class="flex-grow-1 p-3"
             style="overflow-y:auto; background:#ffffff; border-radius:18px;">
            
            <!-- Initial AI message -->
            <div class="d-flex justify-content-start mb-3">
                <div class="chat-bubble ai">
                    <div class="chat-user">AI Tutor</div>
                    <div class="chat-text">
                        Hello üëã I‚Äôm here to help you learn.  
                        Ask anything or start a quiz on any topic!
                    </div>
                </div>
            </div>

        </div>

        <!-- INPUT -->
        <div class="p-3 border-top">
            <div class="input-group">
                <input
                    type="text"
                    id="user-input"
                    class="form-control"
                    placeholder="Type your message..."
                    onkeypress="handleEnter(event)"
                >
                <button class="btn btn-primary px-4" onclick="sendMessage()">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>

    </div>

</div>

<!-- ===== JS (UNCHANGED BACKEND LOGIC) ===== -->
<script>
const chatBox = document.getElementById("chat-box");

function appendMessage(type, sender, text) {
    const wrap = document.createElement("div");
    wrap.className = `d-flex mb-3 ${type === 'user' ? 'justify-content-end' : 'justify-content-start'}`;

    wrap.innerHTML = `
        <div class="chat-bubble ${type}">
            <div class="chat-user">${sender}</div>
            <div class="chat-text">${text}</div>
        </div>
    `;
    chatBox.appendChild(wrap);
    chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
    const input = document.getElementById("user-input");
    const msg = input.value.trim();
    if (!msg) return;

    input.value = "";
    appendMessage("user", "You", msg);

    const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
    });

    const data = await res.json();
    appendMessage("ai", "AI Tutor", data.reply || "Thinking...");
}

function handleEnter(e) {
    if (e.key === "Enter") sendMessage();
}
</script>

<!-- ===== STYLES (LIGHT + YELLOWISH + READABLE) ===== -->
<style>
.chat-bubble {
    max-width: 75%;
    padding: 14px 18px;
    border-radius: 18px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    animation: fadeIn 0.3s ease;
}

/* USER MESSAGE ‚Äì LIGHT YELLOW */
.chat-bubble.user {
    background: linear-gradient(135deg, #ffedd5, #fde68a);
    color: #111827;
}

/* AI MESSAGE ‚Äì SOFT GREY */
.chat-bubble.ai {
    background: #f3f4f6;
    color: #111827;
}

.chat-user {
    font-size: 0.75rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 4px;
}

.chat-text {
    font-size: 0.95rem;
    line-height: 1.45;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}